webpackJsonp([9],{"1/oy":function(t,e){},"9M+g":function(t,e){},GfHa:function(t,e){},Id91:function(t,e){},Jmt5:function(t,e){},NHnr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r={};n.d(r,"signInWith",function(){return ut}),n.d(r,"signOut",function(){return st}),n.d(r,"checkUser",function(){return ot}),n.d(r,"fbGet",function(){return it}),n.d(r,"fbPost",function(){return ct}),n.d(r,"fbUpdate",function(){return lt}),n.d(r,"fbDelete",function(){return pt}),n.d(r,"fbQuery",function(){return ft});var a=n("7+uW"),u=n("Dd8w"),s=n.n(u),o=n("/ocq");a.a.use(o.a);var i=["testComponent1","NumPad","cart","ItemCard","checkout","CustomList"],c=[{key:"ItemOrder",name:"點餐介面"},{key:"Settings",name:"設定"}],l=function(){return n.e(3).then(n.bind(null,"1sVE"))},p=function(){return n.e(0).then(n.bind(null,"RZGl"))},f=function(){return n.e(0).then(n.bind(null,"COBD"))},h=function(){return Promise.all([n.e(0),n.e(5)]).then(n.bind(null,"n7mW"))},m=function(){return Promise.all([n.e(0),n.e(6)]).then(n.bind(null,"N4Va"))},d=function(){return n.e(0).then(n.bind(null,"RFjD"))},b=function(){return n.e(4).then(n.bind(null,"Cw/C"))},v=function(){return Promise.all([n.e(0),n.e(1)]).then(n.bind(null,"3gIu"))},E=function(){return Promise.all([n.e(0),n.e(7)]).then(n.bind(null,"lFos"))},S=function(){return Promise.all([n.e(0),n.e(2)]).then(n.bind(null,"LD5S"))};var g=new o.a({routes:[{path:"/",component:S},{path:"/testComponent1",component:l},{path:"/NumPad",component:p},{path:"/cart",component:f},{path:"/ItemCard",component:h},{path:"/ItemTable",component:b},{path:"/ItemOrder",component:v},{path:"/checkout",component:m},{path:"/CartsTable",component:E},{path:"/CustomList",component:d},{path:"/Settings",component:S}]}),_=n("NYxO"),T={name:"navibar",data:function(){return{components:i,pages:c}},mounted:function(){this.init()},computed:s()({},Object(_.d)(["userInformation","alertSuccess"])),methods:s()({},Object(_.b)(["signInWith","signOut","checkUser"]),{init:function(){var t=this;setTimeout(function(){t.checkUser()},2e3)}})},x={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-navbar",{attrs:{fixed:"top",variant:"light",sticky:""}},[void 0!==t.userInformation?n("b-navbar-nav",{staticClass:"mr-auto"},[t.userInformation.shopId?n("b-dropdown",{attrs:{id:"ddown-left",text:"功能表"}},t._l(t.pages,function(e){return n("b-dropdown-item",{key:e.key,attrs:{to:"/"+e.key}},[t._v("\n        "+t._s(e.name)+"\n      ")])})):t._e()],1):t._e(),t._v(" "),Boolean(t.alertSuccess)?n("b-navbar-nav",[n("b-alert",{attrs:{show:""}},[t._v(t._s(t.alertSuccess))])],1):n("b-navbar-nav",{staticClass:"ml-auto"},[void 0===t.userInformation?n("b-nav-item",[n("b-button",{attrs:{variant:"outline-success"},on:{click:function(e){t.signInWith("google")}}},[t._v("Google登入")]),t._v(" "),n("b-button",{on:{click:function(e){t.signInWith("anon")}}},[t._v("匿名登錄")])],1):n("b-nav-item",[t._v("\n      "+t._s(t.userInformation.displayName)+"\n      "),n("b-button",{attrs:{variant:"outline-danger"},on:{click:function(e){t.signOut()}}},[t._v("登出")])],1)],1)],1)},staticRenderFns:[]},k={name:"App",components:{navibar:n("VU/8")(T,x,!1,null,null,null).exports},computed:s()({},Object(_.d)(["userInformation"]))},A={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("navibar"),this._v(" "),void 0!==this.userInformation?e("router-view"):this._e()],1)},staticRenderFns:[]};var I,w,y=n("VU/8")(k,A,!1,function(t){n("UBzY")},null,null).exports,O=n("bOdI"),C=n.n(O),U=n("pFYg"),R=n.n(U),P=n("d7EF"),F=n.n(P),L=(I={},C()(I,"SET_DATA",function(t,e){var n=F()(e,2),r=n[0],a=n[1];console.log([r,void 0===a?"undefined":R()(a)]),t[r]=a}),C()(I,"SET_ALERTSUCCESS",function(t,e){t.alertSuccess=e,setTimeout(function(){t.alertSuccess=null},5e3)}),C()(I,"SET_ALERTMESSAGE",function(t,e){t.alertMessage=e,setTimeout(function(){t.alertMessage=null},5e3)}),C()(I,"SET_USERINFO",function(t,e){t.userInformation=e,t.login=void 0!==e}),C()(I,"CHECKOUT_ITEM",function(t,e){var n=t.cart.findIndex(function(t){return t.name===e.name&&t.specials_id===e.specials_id});-1==n?t.cart.push(e):t.cart[n].number=parseInt(e.number,10)+parseInt(t.cart[n].number,10)}),C()(I,"CHECKOUT_CART",function(t){t.cart=[]}),C()(I,"CASHIER_RESPONSE",function(t,e){t.cashierOpened="success"===e}),C()(I,"SET_CARTS",function(t,e){var n=F()(e,2),r=n[0];n[1];r.forEach(function(t){t.items.forEach(function(t){t.specials||(t.specials=[])})}),t.carts=r}),C()(I,"REMOVE_CART",function(t,e){var n=t.carts.findIndex(function(t){return t.id===e});-1!==n?t.carts.splice(n,1):console.log("error")}),C()(I,"SET_SHOPS",function(t,e){var n=F()(e,2),r=n[0];n[1];t.shops=r}),I),D=n("Xxa5"),N=n.n(D),G=n("woOf"),M=n.n(G),W=n("exGp"),j=n.n(W),V=n("fZjL"),H=n.n(V),z=n("Zrlr"),Y=n.n(z),B=n("yviF"),q=n.n(B),J=(n("dih4"),n("881v"),w={config:{apiKey:"AIzaSyCxDUSrjbv_vMEica-94tY_k5N8pOkepVM",authDomain:"authtest-4b972.firebaseapp.com",databaseURL:"https://authtest-4b972.firebaseio.com",projectId:"authtest-4b972"}}.config,q.a.initializeApp(w),q.a);J.firestore().settings({timestampsInSnapshots:!0});var K,Q,Z,$,X,tt,et,nt=this,rt=new function t(){Y()(this,t),this.ref=function(t){return t.split("/").reduce(function(t,e,n){return(1+n)%2?t.collection(e):t.doc(e)},J.firestore())},this.timestamp=function(){return J.firestore.FieldValue.serverTimestamp()},this.propDelete=function(){return J.firestore.FieldValue.delete()}},at=new function t(){var e=this;Y()(this,t),this.setPersistence=function(t){return e.auth.setPersistence(J.auth.Auth.Persistence[t])},this.authWithGoogle=function(){return e.auth.signInWithPopup(e.provider)},this.authWithAnon=function(){return e.auth.signInAnonymously()},this.signOut=function(){return e.auth.signOut()},this.getUser=function(){return e.auth.currentUser},this.filterUserInfo=function(t){var e=["uid","displayName","photoURL","email"];return H()(t).filter(function(t){return e.includes(t)}).reduce(function(e,n){return e[n]=t[n],e},{})},this.provider=new q.a.auth.GoogleAuthProvider,this.auth=J.auth()},ut=function(){var t=j()(N.a.mark(function t(e,n){var r,a,u,s,o=e.commit;return N.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,r=null,a=null,u=null,!0!==ot({})){t.next=6;break}return t.abrupt("return");case 6:t.t0=n,t.next="google"===t.t0?9:"anon"===t.t0?13:17;break;case 9:return t.next=11,at.authWithGoogle();case 11:return r=t.sent,t.abrupt("break",18);case 13:return t.next=15,at.authWithAnon();case 15:return r=t.sent,t.abrupt("break",18);case 17:return t.abrupt("return");case 18:if(!r){t.next=25;break}return a=at.filterUserInfo(r.user),at.setPersistence("LOCAL"),t.next=23,it({},["users/"+r.user.uid]);case 23:(u=t.sent)?o("SET_USERINFO",u):(s=M()(a,{identity:null}),ct({},["users/"+s.uid,s]).then(function(){o("SET_USERINFO",s)}));case 25:t.next=30;break;case 27:t.prev=27,t.t1=t.catch(0),o("SET_ALERTMESSAGE",t.t1);case 30:case"end":return t.stop()}},t,nt,[[0,27]])}));return function(e,n){return t.apply(this,arguments)}}(),st=(K=j()(N.a.mark(function t(e){var n=e.commit;return N.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.t0=n,t.next=4,at.signOut();case 4:t.t1=t.sent,(0,t.t0)("SET_USERINFO",t.t1),n("SET_DATA",["items",[]]),n("SET_DATA",["carts",[]]),n("SET_DATA",["my_shop",null]),t.next=14;break;case 11:t.prev=11,t.t2=t.catch(0),n("SET_ALERTMESSAGE",t.t2);case 14:case"end":return t.stop()}},t,nt,[[0,11]])})),function(t){return K.apply(this,arguments)}),ot=(Q=j()(N.a.mark(function t(e){var n,r=e.commit;return N.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,null===at.getUser()){t.next=10;break}return t.next=4,it({},["users/"+at.getUser().uid]);case 4:return n=t.sent,r("SET_USERINFO",n),null!==n.shopId&&it({commit:r},["shops/"+n.shopId,"my_shop"]),t.abrupt("return",!0);case 10:return t.abrupt("return",!1);case 11:t.next=17;break;case 13:t.prev=13,t.t0=t.catch(0),r("SET_ALERTMESSAGE",t.t0),console.error(t.t0);case 17:case"end":return t.stop()}},t,nt,[[0,13]])})),function(t){return Q.apply(this,arguments)}),it=(Z=j()(N.a.mark(function t(e,n){var r,a=e.commit,u=F()(n,2),s=u[0],o=u[1];return N.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,r=null,"object"!==(void 0===s?"undefined":R()(s))){t.next=9;break}return console.log("Access query: {ref} GET"),t.next=6,s.get();case 6:r=t.sent,t.next=13;break;case 9:return console.log("Access path: "+s+" GET"),t.next=12,rt.ref(s).get();case 12:r=t.sent;case 13:if(!r){t.next=24;break}if(r=ht(r),console.log([s,r,"container: "+o]),!o){t.next=21;break}console.log(["commit to container",r]),a("SET_DATA",[o,r]),t.next=22;break;case 21:return t.abrupt("return",r);case 22:t.next=25;break;case 24:return t.abrupt("return",null);case 25:t.next=30;break;case 27:return t.prev=27,t.t0=t.catch(0),t.abrupt("return",t.t0);case 30:case"end":return t.stop()}},t,nt,[[0,27]])})),function(t,e){return Z.apply(this,arguments)}),ct=($=j()(N.a.mark(function t(e,n){e.commit;var r,a=F()(n,2),u=a[0],s=a[1];return N.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,console.log("Access path: "+u+" POST"),r=rt.ref(u),M()(s,{date:rt.timestamp()}),!("set"in r)){t.next=8;break}return t.abrupt("return",r.set(s));case 8:return t.abrupt("return",r.add(s));case 9:t.next=14;break;case 11:return t.prev=11,t.t0=t.catch(0),t.abrupt("return",t.t0);case 14:case"end":return t.stop()}},t,nt,[[0,11]])})),function(t,e){return $.apply(this,arguments)}),lt=(X=j()(N.a.mark(function t(e,n){var r,a,u=e.commit,s=F()(n,2),o=s[0],i=s[1];return N.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(r in t.prev=0,console.log("Access path: "+o+" UPDATE"),i.roles)"fb.firestore.FieldValue.delete"===i.roles[r]&&(i.roles[r]=rt.timestamp());return M()(i,{last_update:rt.timestamp()}),t.next=6,rt.ref(o).update(i);case 6:return void 0===(a=t.sent)&&u("SET_ALERTSUCCESS","更新成功"),t.abrupt("return",a);case 11:return t.prev=11,t.t0=t.catch(0),t.abrupt("return",t.t0);case 14:case"end":return t.stop()}},t,nt,[[0,11]])})),function(t,e){return X.apply(this,arguments)}),pt=(tt=j()(N.a.mark(function t(e,n){var r,a=e.commit,u=F()(n,1)[0];return N.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,console.log("Access path: "+u+" DELETE"),t.next=4,rt.ref(u).delete();case 4:return void 0===(r=t.sent)&&a("SET_ALERTSUCCESS","刪除成功"),t.abrupt("return",r);case 9:return t.prev=9,t.t0=t.catch(0),t.abrupt("return",t.t0);case 12:case"end":return t.stop()}},t,nt,[[0,9]])})),function(t,e){return tt.apply(this,arguments)}),ft=(et=j()(N.a.mark(function t(e,n){var r,a=e.commit,u=F()(n,3),s=u[0],o=u[1],i=u[2];return N.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=o.split("_"),console.log(["query path",o]),t.next=4,rt.ref(s).where(o[0],o[1],o[2]);case 4:if(!(r=t.sent)){t.next=10;break}return console.log(["fbQuery pass result",r]),t.abrupt("return",it({commit:a},[r,i]));case 10:return console.log("notFound"),t.abrupt("return",null);case 12:case"end":return t.stop()}},t,nt)})),function(t,e){return et.apply(this,arguments)}),ht=function(t){if("docs"in t){var e=[];t.forEach(function(t){var n=t.data();n.id=t.id,e.push(n)}),t=e}else t=t.exists?t.data():null;return t};a.a.use(_.a);var mt={items:[],cart:[],carts:[],shops:[],my_shop:null,cashierOpened:!1,userInformation:void 0,alertMessage:null,alertSuccess:null,login:null},dt=new _.a.Store({state:mt,mutations:L,actions:r}),bt=n("e6fC");n("Jmt5"),n("9M+g");a.a.use(bt.a),a.a.config.productionTip=!1,new a.a({el:"#app",router:g,store:dt,components:{App:y},template:"<App/>"})},UBzY:function(t,e){},zj2Q:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.6064f4fffd915214e248.js.map