webpackJsonp([2,4,7],{"1Xi5":function(e,t){},"Cw/C":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("fZjL"),s=n.n(i),a=n("Dd8w"),r=n.n(a),o=n("NYxO"),l=n("woOf"),u=n.n(l),c={name:"ItemForm",props:{itemList:{type:Array,default:function(){return[]}}},data:function(){return{collections:[],area_show:!1,exist_alert:!1,itemList_fields:[{key:"name",label:"名稱"},{key:"price",label:"價格"},{key:"action",label:""}],new_item:{name:{inputType:"text",prepend:"名稱",value:null,special_temp:null,special:[]},price:{inputType:"number",prepend:"價錢",value:null,special_temp:null,special:[]}}}},methods:{addToList:function(){var e=this;""!==this.new_item.name.value&&(-1===this.itemList.findIndex(function(t){return t.name===e.new_item.name.value})?(this.exist_alert=!1,this.itemList.push(u()({},{name:this.new_item.name.value,price:this.new_item.price.value}))):this.exist_alert=!0);this.$emit("set-item-result",this.itemList),this.clearInput()},clearInput:function(){this.new_item.name.value=null,this.new_item.price.value=null},removeFromList:function(e){var t=this.itemList.findIndex(function(t){return t.name===e.name});-1!==t&&this.itemList.splice(t,1)},ifDisabled:function(e,t){for(var n=s()(e),i=!1,a=0;a<n.length;a+=1)t?e[n[a]][t]||(i=!0):e[n[a]]||(i=!0);return i}}},m={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("b-alert",{attrs:{show:""}},[n("p",[e._v("\n      客製清單"),!1===e.area_show?n("span",[e._v("( "+e._s(e.itemList.length)+" 項)")]):e._e()]),e._v(" "),n("b-button",{on:{click:function(t){e.area_show=!e.area_show}}},[e._v(e._s(e.area_show?"收合":"展開"))])],1),e._v(" "),!0===e.area_show?n("div",[e.itemList.length>0?n("div",[n("b-table",{attrs:{items:e.itemList,fields:e.itemList_fields},scopedSlots:e._u([{key:"action",fn:function(t){return[n("b-button",{staticClass:"mr-1",attrs:{size:"sm"},on:{click:function(n){n.stopPropagation(),e.removeFromList(t.item)}}},[e._v("\n            刪除\n          ")])]}}])})],1):n("div",[n("p",[e._v("沒有客製項目")])]),e._v(" "),n("div",[n("b-card",{attrs:{"no-body":""}},[n("b-alert",{attrs:{variant:"danger",dismissible:"",show:e.exist_alert},on:{dismissed:function(t){e.exist_alert=!1}}},[e._v("已在清單上")])],1),e._v(" "),e._l(Object.keys(e.new_item),function(t,i){return n("b-input-group",{key:i,attrs:{prepend:e.new_item[t].prepend}},["checkbox"===e.new_item[t].inputType?n("input",{directives:[{name:"model",rawName:"v-model",value:e.new_item[t].value,expression:"new_item[key].value"}],staticClass:"form-control",attrs:{min:"0",type:"checkbox"},domProps:{checked:Array.isArray(e.new_item[t].value)?e._i(e.new_item[t].value,null)>-1:e.new_item[t].value},on:{change:function(n){var i=e.new_item[t].value,s=n.target,a=!!s.checked;if(Array.isArray(i)){var r=e._i(i,null);s.checked?r<0&&e.$set(e.new_item[t],"value",i.concat([null])):r>-1&&e.$set(e.new_item[t],"value",i.slice(0,r).concat(i.slice(r+1)))}else e.$set(e.new_item[t],"value",a)}}}):"radio"===e.new_item[t].inputType?n("input",{directives:[{name:"model",rawName:"v-model",value:e.new_item[t].value,expression:"new_item[key].value"}],staticClass:"form-control",attrs:{min:"0",type:"radio"},domProps:{checked:e._q(e.new_item[t].value,null)},on:{change:function(n){e.$set(e.new_item[t],"value",null)}}}):n("input",{directives:[{name:"model",rawName:"v-model",value:e.new_item[t].value,expression:"new_item[key].value"}],staticClass:"form-control",attrs:{min:"0",type:e.new_item[t].inputType},domProps:{value:e.new_item[t].value},on:{input:function(n){n.target.composing||e.$set(e.new_item[t],"value",n.target.value)}}})])}),e._v(" "),n("b-button",{attrs:{disabled:e.ifDisabled(e.new_item,"value"),variant:"success"},on:{click:function(t){e.addToList()}}},[e._v("確定")]),e._v(" "),n("b-button",{on:{click:function(t){e.clearInput()}}},[e._v("重填")])],2)]):e._e()],1)},staticRenderFns:[]},p={name:"ItemTable",components:{ItemForm:n("VU/8")(c,m,!1,null,null,null).exports},data:function(){return{fields:{name:{label:"名稱"},specials:{label:"客製"},price:{label:"價格"},actions:{label:"修改"}},new_item:{name:{inputType:"text",prepend:"名稱",value:null},price:{inputType:"number",prepend:"價錢",value:null}},specials:[]}},mounted:function(){this.init()},props:{manage:!1},computed:r()({},Object(o.d)(["items","userInformation"]),{fetched:function(){return!!this.items}}),methods:r()({},Object(o.b)(["fbGet","fbPost","fbUpdate","fbDelete"]),{init:function(){this.getShopItem()},addItem:function(e){var t=this;this.fbPost(["shops/"+this.userInformation.shopId+"/items",{name:e.name.value,price:"string"==typeof e.price.value?parseInt(e.price.value,10):e.price.value,specials:this.specials}]).then(function(e){e.id&&(s()(t.new_item).forEach(function(e){t.new_item[e].value=null,t.specials=[]}),t.getShopItem())})},getShopItem:function(){this.fbGet(["shops/"+this.userInformation.shopId+"/items","items"])},deleteItem:function(e,t){var n=this;this.fbDelete(["shops/"+this.userInformation.shopId+"/items/"+e.id]).then(function(){n.items.splice(t,1),delete n.$store.state.items[e.name]})},updateItem:function(e){e.specials.forEach(function(e){return e.price=parseInt(e.price,10)}),this.fbUpdate(["shops/"+this.userInformation.shopId+"/items/"+e.id,{name:e.name,price:e.price,specials:e.specials}])},ifDisabled:function(e,t){for(var n=s()(e),i=!1,a=0;a<n.length;a+=1)t?e[n[a]][t]||(i=!0):e[n[a]]||(i=!0);return i}})},d={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.fetched?e._e():n("b-button",{on:{click:e.getShopItem}},[e._v("取得清單")]),e._v(" "),0===e.items.length?n("div",[e.manage?n("h5",[e._v("沒有商品記錄，請新增一項商品")]):n("h5",[e._v("這間店空空的，叫你老闆拿東西出來賣")])]):n("div",[n("b-table",{attrs:{responsive:"",items:e.items,fields:e.fields},scopedSlots:e._u([{key:"specials",fn:function(t){return e._l(t.unformatted,function(t,i){return n("b-list-group-item",{key:i},[n("p",{staticClass:"name"},[e._v(e._s(t.name)),n("span",{staticClass:"name-tag"},[e._v("$ "+e._s(t.price))])])])})}},{key:"actions",fn:function(t){return e.manage?[n("b-button",{attrs:{size:"sm"},on:{click:function(e){return e.stopPropagation(),t.toggleDetails(e)}}},[e._v("\n          "+e._s(t.detailsShowing?"關閉":"修改")+"\n        ")])]:void 0}},{key:"name",fn:function(t){return[n("p",{staticClass:"name"},[e._v(e._s(t.item.name))])]}},{key:"row-details",fn:function(t){return e.manage?[n("b-card",{attrs:{"bg-variant":"secondary"}},[n("b-input-group",{attrs:{prepend:"名稱"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.item.name,expression:"row.item.name"}],staticClass:"form-control",domProps:{value:t.item.name},on:{input:function(n){n.target.composing||e.$set(t.item,"name",n.target.value)}}})]),e._v(" "),n("b-input-group",{attrs:{prepend:"價格"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.item.price,expression:"row.item.price"}],staticClass:"form-control",attrs:{min:"0",type:"number"},domProps:{value:t.item.price},on:{input:function(n){n.target.composing||e.$set(t.item,"price",n.target.value)}}})]),e._v(" "),e._l(t.item.specials,function(t,i){return n("div",{key:i},[n("b-input-group",{attrs:{prepend:"客製"+(i+1)+"名稱"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"special.name"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:t.name},on:{input:function(n){n.target.composing||e.$set(t,"name",n.target.value)}}})]),e._v(" "),n("b-input-group",{attrs:{prepend:"客製"+(i+1)+"價格"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.price,expression:"special.price"}],staticClass:"form-control",attrs:{type:"number",min:"0"},domProps:{value:t.price},on:{input:function(n){n.target.composing||e.$set(t,"price",n.target.value)}}})])],1)}),e._v(" "),n("b-button",{attrs:{disabled:!0===e.ifDisabled(t.item),variant:e.ifDisabled(t.item)?"":"success"},on:{click:function(n){e.updateItem(t.item)}}},[e._v("更新商品")]),e._v(" "),n("b-button",{attrs:{variant:"danger"},on:{click:function(n){n.stopPropagation(),e.deleteItem(t.item,t.index)}}},[e._v("刪除商品")])],2)]:void 0}}])})],1),e._v(" "),e.manage?n("b-card-group",[n("b-card",[e._l(Object.keys(e.new_item),function(t,i){return n("b-input-group",{key:i,attrs:{prepend:e.new_item[t].prepend}},["checkbox"===e.new_item[t].inputType?n("input",{directives:[{name:"model",rawName:"v-model",value:e.new_item[t].value,expression:"new_item[key].value"}],staticClass:"form-control",attrs:{min:"0",type:"checkbox"},domProps:{checked:Array.isArray(e.new_item[t].value)?e._i(e.new_item[t].value,null)>-1:e.new_item[t].value},on:{change:function(n){var i=e.new_item[t].value,s=n.target,a=!!s.checked;if(Array.isArray(i)){var r=e._i(i,null);s.checked?r<0&&e.$set(e.new_item[t],"value",i.concat([null])):r>-1&&e.$set(e.new_item[t],"value",i.slice(0,r).concat(i.slice(r+1)))}else e.$set(e.new_item[t],"value",a)}}}):"radio"===e.new_item[t].inputType?n("input",{directives:[{name:"model",rawName:"v-model",value:e.new_item[t].value,expression:"new_item[key].value"}],staticClass:"form-control",attrs:{min:"0",type:"radio"},domProps:{checked:e._q(e.new_item[t].value,null)},on:{change:function(n){e.$set(e.new_item[t],"value",null)}}}):n("input",{directives:[{name:"model",rawName:"v-model",value:e.new_item[t].value,expression:"new_item[key].value"}],staticClass:"form-control",attrs:{min:"0",type:e.new_item[t].inputType},domProps:{value:e.new_item[t].value},on:{input:function(n){n.target.composing||e.$set(e.new_item[t],"value",n.target.value)}}})])}),e._v(" "),n("b-button",{attrs:{disabled:!0===e.ifDisabled(e.new_item,"value"),variant:e.ifDisabled(e.new_item,"value")?"":"success"},on:{click:function(t){e.addItem(e.new_item),e.flipCustom=!0}}},[e._v("新增商品")])],2),e._v(" "),n("b-card",[n("item-form",{attrs:{"item-list":e.specials},on:{"set-item-result":function(t){e.specials=t}}})],1)],1):e._e()],1)},staticRenderFns:[]};var f=n("VU/8")(p,d,!1,function(e){n("WZbN")},"data-v-6b06aaa8",null);t.default=f.exports},LD5S:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("bOdI"),s=n.n(i),a=n("Dd8w"),r=n.n(a),o=n("NYxO"),l=n("Cw/C"),u=n("lFos"),c={name:"Settings",components:{ItemTable:l.default,CartsTable:u.default},data:function(){return{shops:[],new_shopName:"",workers:[],workers_fields:[{key:"date",label:"Time"},{key:"name",label:"Name"},{key:"role",label:"Role"}]}},mounted:function(){this.init()},computed:r()({},Object(o.d)(["userInformation","my_shop"]),{isOwner:function(){var e=this,t=this.userInformation.shopId;return!!t&&(this.my_shop.ownerUid===this.userInformation.uid&&(this.fbGet(["shops/"+t+"/workers"]).then(function(t){e.workers=t}),!0))}}),methods:r()({},Object(o.b)(["checkUser","fbGet","fbUpdate","fbPost","fbDelete","fbQuery"]),{init:function(){this.getShops()},getShops:function(){var e=this;this.userInformation.shopId||this.fbGet(["shops"]).then(function(t){e.shops=t})},createShop:function(e){var t=this,n=this.userInformation.uid;this.updateUser(),this.fbPost(["shops",{ownerUid:n,ownerName:this.userInformation.displayName,name:e,roles:s()({},n,"Owner")}]).then(function(i){t.fbUpdate(["users/"+n,{shopId:i.id,shopName:e}])}).then(function(){t.checkUser()})},joinShop:function(e,t){var n=this,i=this.userInformation.uid;this.updateUser(),this.fbPost(["shops/"+e+"/workers/"+i,{name:this.userInformation.displayName}]).then(function(){n.fbUpdate(["users/"+i,{shopId:e,shopName:t}])}).then(function(){n.checkUser()})},updateUser:function(e){var t=this,n=this.userInformation;e&&e.forEach(function(e){return n[e]=null}),this.fbUpdate(["users/"+this.userInformation.uid,n]).then(function(e){return t.checkUser()})},getTime:function(e){var t=new Date(e),n=t.getFullYear()+"年"+(t.getMonth()+1)+"月"+t.getDate()+"日",i=[t.getHours(),t.getMinutes(),t.getSeconds()],s=[":",":",""],a="";for(var r in i)a=i[r]<10?a+"0"+i[r]+s[r]:a+i[r]+s[r];return[n,a]},letWorker:function(e,t){var n=this,i=this.workers[t],s=this.userInformation.shopId,a={};switch(e){case"add":this.fbUpdate(["shops/"+s+"/workers/"+i.id,{role:"employee"}]),a[i.id]="employee",i.role="employee";break;case"delete":this.fbDelete(["shops/"+s+"/workers/"+i.id]),a[i.id]="fb.firestore.FieldValue.delete",this.workers.splice(t,1)}this.fbUpdate(["shops/"+s,{roles:a}]).then(function(e){return n.checkUser()})}})},m={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-card",{attrs:{"no-body":""}},[n("b-tabs",{attrs:{card:""}},[n("b-tab",{attrs:{title:"使用者",active:""}},[void 0!==e.userInformation?n("div",[n("b-card",[e.userInformation.shopName?n("div",[n("b-alert",{attrs:{show:""}},[e._v("\n              你已加入"+e._s(e.userInformation.shopName)+"\n            ")])],1):n("div",[n("b-input-group",{attrs:{prepend:"稱呼"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.userInformation.displayName,expression:"userInformation.displayName"}],staticClass:"form-control",attrs:{type:"text",placeholder:"輸入你的稱呼"},domProps:{value:e.userInformation.displayName},on:{input:function(t){t.target.composing||e.$set(e.userInformation,"displayName",t.target.value)}}}),e._v(" "),n("b-input-group-append",[n("b-button",{attrs:{variant:"info",disabled:""===e.userInformation.displayName},on:{click:function(t){e.updateUser()}}},[e._v("確定")])],1)],1)],1)])],1):e._e(),e._v(" "),e.userInformation.displayName?n("div",[e.userInformation.shopId?e._e():n("div",[n("b-card",{attrs:{title:"我是老闆，建立商店"}},[n("b-input-group",{attrs:{prepend:"店名"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.new_shopName,expression:"new_shopName"}],staticClass:"form-control",domProps:{value:e.new_shopName},on:{input:function(t){t.target.composing||(e.new_shopName=t.target.value)}}}),e._v(" "),n("b-input-group-append",[n("b-button",{attrs:{variant:"info"},on:{click:function(t){e.createShop(e.new_shopName)}}},[e._v("建立")])],1)],1)],1),e._v(" "),n("b-card",{attrs:{title:"我是員工，加入商店"}},[n("b-table",{attrs:{items:e.shops,fields:[{key:"name",label:"商店名稱"},{key:"action",label:""}]},scopedSlots:e._u([{key:"name",fn:function(t){return[e._v("\n                  "+e._s(t.item.ownerName)+"的"+e._s(t.item.name)+"                    \n                ")]}},{key:"action",fn:function(t){return[n("b-input-group-append",[n("b-button",{attrs:{variant:"info"},on:{click:function(n){e.joinShop(t.item.id,t.item.name)}}},[e._v("加入")])],1)]}}])}),e._v(" "),n("b-btn",{on:{click:function(t){e.getShops()}}},[e._v("刷新")])],1)],1)]):e._e()]),e._v(" "),e.userInformation.shopId?n("b-tab",{attrs:{title:"商店",active:Boolean(e.userInformation.shopId)}},[e.my_shop?n("b-card",{attrs:{"no-body":""}},[n("b-tabs",{attrs:{pills:"",card:""}},[n("b-tab",{attrs:{title:"商品",active:""}},[n("item-table",{attrs:{manage:e.isOwner}})],1),e._v(" "),n("b-tab",{attrs:{title:"訂單"}},[n("carts-table",{attrs:{manage:e.isOwner}})],1),e._v(" "),e.isOwner?n("b-tab",{attrs:{title:"員工"}},[e.workers.length>0?n("div",[n("b-table",{attrs:{items:e.workers,fields:e.workers_fields},scopedSlots:e._u([{key:"role",fn:function(t){return[n("span",[e._v(e._s(t.item.role))]),e._v(" "),void 0===t.item.role?n("b-button",{on:{click:function(n){e.letWorker("add",t.index)}}},[e._v("Confirm")]):e._e(),e._v(" "),n("b-button",{on:{click:function(n){e.letWorker("delete",t.index)}}},[e._v("Delete")])]}},{key:"date",fn:function(t){return[n("p",[e._v(e._s(e.getTime(1e3*t.item.date.seconds)[0]))]),e._v(" "),n("p",[e._v(e._s(e.getTime(1e3*t.item.date.seconds)[1]))])]}}])})],1):n("div",[e._v("\n              沒有員工資料\n            ")])]):e._e()],1)],1):n("b-card",[n("p",[e._v("\n          你已加入"+e._s(e.userInformation.shopName)+"，但尚未有權限。更新時間："+e._s(e.getTime(Date.now())[0])+" "+e._s(e.getTime(Date.now())[1])+"\n        ")]),e._v(" "),n("b-btn",{on:{click:function(t){e.updateUser(["shopId","shopName"])}}},[e._v("退出")]),e._v(" "),n("b-btn",{on:{click:function(t){e.checkUser()}}},[e._v("\n          刷新\n        ")])],1)],1):e._e()],1)],1)},staticRenderFns:[]},p=n("VU/8")(c,m,!1,null,null,null);t.default=p.exports},WZbN:function(e,t){},lFos:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("Dd8w"),s=n.n(i),a=n("NYxO"),r={name:"CartsTable",components:{cart:n("COBD").default},props:{manage:!1},data:function(){return{fields:[{key:"date",label:"時間"},{key:"items",label:"訂單"},{key:"cash",label:"收銀"},{key:"action",label:""}]}},mounted:function(){this.init()},computed:s()({},Object(a.d)(["carts","userInformation"])),methods:s()({},Object(a.b)(["fbGet","fbDelete"]),{init:function(){this.getShopCart()},getShopCart:function(){this.fbGet(["shops/"+this.userInformation.shopId+"/carts","carts"])},getTime:function(e){var t=new Date(e),n=t.getFullYear()+"年"+(t.getMonth()+1)+"月"+t.getDate()+"日",i=[t.getHours(),t.getMinutes(),t.getSeconds()],s=[":",":",""],a="";for(var r in i)a=i[r]<10?a+"0"+i[r]+s[r]:a+i[r]+s[r];return[n,a]},deleteCart:function(e){var t=this;this.fbDelete(["shops/"+this.userInformation.shopId+"/carts/"+e,e]).then(function(){t.$store.commit("REMOVE_CART",e)})}})},o={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.carts.length>0?n("div",[n("b-table",{attrs:{responsive:"",items:e.carts,fields:e.fields},scopedSlots:e._u([{key:"items",fn:function(t){return[n("p",{staticClass:"stat"},[e._v(e._s(t.item.stat)+" "+e._s(t.item.price)+"$")]),e._v(" "),n("b-button",{attrs:{variant:"outline-primary"},on:{click:t.toggleDetails}},[e._v(e._s(t.detailsShowing?"關閉":"清單")),n("b-badge",[e._v(e._s(t.item.items.length))])],1)]}},{key:"row-details",fn:function(e){return[n("cart",{attrs:{cart:e.item.items,orderable:!1,numberVariable:!1}})]}},{key:"action",fn:function(t){return[e.manage?n("b-button",{on:{click:function(n){e.deleteCart(t.item.id)}}},[e._v("刪除")]):e._e()]}},{key:"date",fn:function(t){return[n("p",{staticClass:"date"},[e._v(e._s(e.getTime(1e3*t.item.date.seconds)[0]))]),e._v(" "),n("p",{staticClass:"time"},[e._v(e._s(e.getTime(1e3*t.item.date.seconds)[1]))])]}}])})],1):n("div",[n("h5",[e._v("沒有訂單記錄")])])])},staticRenderFns:[]};var l=n("VU/8")(r,o,!1,function(e){n("1Xi5")},"data-v-0cb41534",null);t.default=l.exports}});